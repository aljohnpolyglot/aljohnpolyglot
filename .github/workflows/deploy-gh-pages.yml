# .github/workflows/deploy-polyglot-connect.yml
name: Deploy Polyglot Connect to GitHub Pages Subdirectory

on:
  push:
    branches:
      - main # Or your main deployment branch
    paths: # Optional: Only run this workflow if files in polyglot_connect change
      - 'polyglot_connect/**'
      - '.github/workflows/deploy-polyglot-connect.yml' # Or if the workflow itself changes
  workflow_dispatch: # Allows manual triggering

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v4

      - name: Create API Keys file for Polyglot Connect 🔑
        run: |
          mkdir -p polyglot_connect/js/config  # Path relative to repo root
          echo "// This file is auto-generated by GitHub Action during deployment." > polyglot_connect/js/config/api_keys.js
          echo "console.log('api_keys.js (generated by GitHub Action for Polyglot Connect) loaded.');" >> polyglot_connect/js/config/api_keys.js
          echo "window.GEMINI_API_KEY = '${{ secrets.POLYGLOT_CONNECT_GEMINI_API_KEY }}';" >> polyglot_connect/js/config/api_keys.js
          echo "window.GEMINI_API_KEY_ALT = '${{ secrets.POLYGLOT_CONNECT_GEMINI_API_KEY_ALT }}';" >> polyglot_connect/js/config/api_keys.js
          echo "window.GROQ_API_KEY = '${{ secrets.POLYGLOT_CONNECT_GROQ_API_KEY }}';" >> polyglot_connect/js/config/api_keys.js
          echo "window.TOGETHER_API_KEY = '${{ secrets.POLYGLOT_CONNECT_TOGETHER_API_KEY }}';" >> polyglot_connect/js/config/api_keys.js
        env:
          POLYGLOT_CONNECT_GEMINI_API_KEY: ${{ secrets.POLYGLOT_CONNECT_GEMINI_API_KEY }}
          POLYGLOT_CONNECT_GEMINI_API_KEY_ALT: ${{ secrets.POLYGLOT_CONNECT_GEMINI_API_KEY_ALT }}
          POLYGLOT_CONNECT_GROQ_API_KEY: ${{ secrets.POLYGLOT_CONNECT_GROQ_API_KEY }}
          POLYGLOT_CONNECT_TOGETHER_API_KEY: ${{ secrets.POLYGLOT_CONNECT_TOGETHER_API_KEY }}

      - name: Deploy Polyglot Connect to gh-pages 🚀
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./polyglot_connect # <<<< CRITICAL: Publish ONLY the polyglot_connect subfolder
          # By default, this action clears the destination branch (gh-pages).
          # If your library and other parts of aljohnpolyglot are deployed differently
          # or also to gh-pages in the root, this needs careful handling.
          # Consider deploying Polyglot Connect to a subdirectory on gh-pages, e.g., gh-pages/polyglot_connect/
          # To do that, you might need to adjust publish_dir and how GitHub Pages is configured.

          # A common setup if gh-pages branch serves your whole site:
          # publish_branch: gh-pages # Default
          # If you want Polyglot Connect to be at your-username.github.io/repo-name/polyglot_connect/
          # And your index.html for polyglot_connect is inside the polyglot_connect folder,
          # then publish_dir: ./polyglot_connect and target_dir: polyglot_connect
          # MIGHT BE NEEDED if gh-pages already has content in its root:
          # keep_files: true # To avoid wiping other content in gh-pages if deploying to root
          # Or better: deploy polyglot_connect to a subfolder in gh-pages:
          destination_dir: ./polyglot_connect # Deploy to a 'polyglot_connect' subfolder on gh-pages branch